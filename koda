<!DOCTYPE html>
<html>
<head>
	<title>Spletna stran z vgrajeno kamero in učinki</title>
	<style>
		#video {
			width: 640px;
			height: 480px;
			background-color: black;
		}
		#canvas {
			display: none;
		}
	</style>
</head>
<body>
	<h1>Spletna stran z vgrajeno kamero in učinki</h1>
	<video id="video"></video>
	<canvas id="canvas"></canvas>
	<button id="capture">Zajemi sliko</button>
	<select id="filters">
		<option value="none">Brez filtra</option>
		<option value="grayscale">Sivinski filtri</option>
		<option value="sepia">Sepia filtri</option>
		<option value="invert">Inverzni filtri</option>
	</select>
	<script>
		const video = document.getElementById('video');
		const canvas = document.getElementById('canvas');
		const context = canvas.getContext('2d');
		const captureButton = document.getElementById('capture');
		const filters = document.getElementById('filters');

		navigator.mediaDevices.getUserMedia({ video: true })
			.then((stream) => {
				video.srcObject = stream;
				video.play();
			});

		video.addEventListener('play', () => {
			setInterval(() => {
				context.drawImage(video, 0, 0, 640, 480);
				const pixels = context.getImageData(0, 0, 640, 480);
				const filter = filters.value;
				if (filter === 'grayscale') {
					for (let i = 0; i < pixels.data.length; i += 4) {
						const gray = pixels.data[i] * 0.3 + pixels.data[i + 1] * 0.59 + pixels.data[i + 2] * 0.11;
						pixels.data[i + 0] = gray;
						pixels.data[i + 1] = gray;
						pixels.data[i + 2] = gray;
					}
				} else if (filter === 'sepia') {
					for (let i = 0; i < pixels.data.length; i += 4) {
						const r = pixels.data[i];
						const g = pixels.data[i + 1];
						const b = pixels.data[i + 2];
						pixels.data[i + 0] = (r * 0.393) + (g * 0.769) + (b * 0.189);
						pixels.data[i + 1] = (r * 0.349) + (g * 0.686) + (b * 0.168);
						pixels.data[i + 2] = (r * 0.272) + (g * 0.534) + (b * 0.131);
					}
				} else if (filter === 'invert') {
					for (let i = 0; i < pixels.data.length; i += 4) {
						pixels.data[i + 0] = 255 - pixels.data[i + 0];
						pixels.data[i + 1] = 255 - pixels.data[i + 1];
						pixels.data[i + 2] = 255 - pixels.data[i + 2];
					}
				}
				context.putImageData(pixels, 0, 0);
			}, 16);
		});

		captureButton.addEventListener('click', () => {
			canvas.toBlob((blob) => {
				const url = URL.createObjectURL(blob);
				const link = document.createElement('a');
				link.href = url;
				link.download = 'slika.png';
				link.click();
				URL.revokeObjectURL(url);
			});
		});
	</script>
</body>
</html>
